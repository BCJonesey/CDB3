<%- model_class = Award.new.class -%>
<h1><%=t '.title', :default => model_class.model_name.human.pluralize %></h1>


<%= form_for [@game,@award],:url=>request_award_game_awards_path(@game), :html => { :class => 'form-horizontal' } do |f| %>
<%= render :partial => 'shared/form_errors', :locals => {:item => @award} %>
  
  <div class="control-group">
    <%= f.label :amount, :class => 'control-label' %>
    <div class="controls">
      <%= f.number_field :amount, :class => 'number_field' %>
    </div>
  </div>
  <div class="control-group">
    <%= f.label :currency_id, :class => 'control-label' %>
    <div class="controls">
      <%= f.select :currency_id, options_from_collection_for_select(@game.currencies, "id", "name"), :class => 'control-label' %>
    </div>
  </div>
  <div class="control-group">
    <%= f.label :comment, :class => 'control-label' %>
    <div class="controls">
      <%= f.text_area :comment, :class => 'text_area' %>
    </div>
  </div>

  <div class="form-actions">
    <%= f.submit nil, :class => 'btn btn-primary' %>
    <%= link_to t('.cancel', :default => t("helpers.links.cancel")),
                game_awards_path(@game), :class => 'btn' %>
  </div>
<% end %>



<table class="table table-striped">
  <thead>
    <tr>
      <th><%= Award.human_attribute_name(:amount) %></th>
      <th>Currency</th>
      <th><%= Award.human_attribute_name(:comment) %></th>
      <th>Created By</th>
      <th>Approved By</th>
      <th><%= Award.human_attribute_name(:created_at) %></th>
    </tr>
  </thead>
  <tbody>
    <% @member.awards.unassigned.approved.each do |award| %>
      <tr>
        <td><%= award.amount %></td>
        <td><%= award.currency.name %></td>
        <td><%= award.comment %></td>
        <td><%= award.created_by.name %></td>
        <td><%= award.approved_by.name %></td>
        <td><%= award.created_at %></td>
        <td>
          <div class="btn-group">
	    <button class="btn">Assign to Character</button>
	    <button class="btn dropdown-toggle" data-toggle="dropdown">
	      <span class="caret"></span>
	    </button>
	    <ul class="dropdown-menu">
	      <% @member.characters.each do |character| %>
	      <li>
		<%= link_to character.name, assign_game_award_path(@game,award,:character_id=>character.id) %>
	      </li>
	      <% end %>
	    </ul>
	  </div>
        <% if(@member.is_admin) %>
        
          <%= link_to t('.edit', :default => t("helpers.links.edit")),
                      edit_game_award_path(@game,award), :class => 'btn btn-mini' %>
          <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                      game_award_path(@game,award),
                      :method => :delete,
                      :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')),
                      :class => 'btn btn-mini btn-danger' %>
        
        <% end %>
        </td>
      </tr>
    <% end %>
      <tr>
	<td colspan="8">Pending Awards</td>
      <tr>
    <% @member.awards.pending.each do |award| %>
        <tr>
        <td><%= award.amount %></td>
        <td><%= award.currency.name%></td>
        <td><%= award.comment %></td>
        <td><%= award.created_by.name %></td>
        <td></td>
        <td><%= award.created_at %></td>
        <% if(@member.is_admin) %>
        <td>
          <%= link_to t('.edit', :default => t("helpers.links.edit")),
                      edit_game_award_path(@game,award), :class => 'btn btn-mini' %>
	  <%= link_to 'Approve',
                      approve_game_award_path(@game,award),
                      :class => 'btn btn-mini btn-success' %>
          <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                      game_award_path(@game,award),
                      :method => :delete,
                      :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')),
                      :class => 'btn btn-mini btn-danger' %>
        </td>
        <% end %>
      </tr>
    <% end %>
    <tr>
	<td colspan="8"><h3>Assigned Awards</h3></td>
      <tr>
      <% @member.characters.each do |char| %>
          <tr>
	<td colspan="8"><h4><%= char.name %></h4></td>
      <tr>
	<% char.awards.each do |award| %>
	  <tr>
	    <td><%= award.amount %></td>
	    <td><%= award.currency.name %></td>
	    <td><%= award.comment %></td>
	    <td><%= award.created_by.name %></td>
	    <td><%= award.approved_by.name %></td>
	    <td><%= award.created_at %></td>
	    <td>
	    <% if(@member.is_admin) %>
	      <div class="btn-group">
		<button class="btn">Assign to Character</button>
		<button class="btn dropdown-toggle" data-toggle="dropdown">
		  <span class="caret"></span>
		</button>
		<ul class="dropdown-menu">
		  <% @member.characters.each do |character| %>
		  <li>
		    <%= link_to character.name, assign_game_award_path(@game,award,:character_id=>character.id) %>
		  </li>
		  <% end %>
		</ul>
	      </div>
	    
	    
	      <%= link_to t('.edit', :default => t("helpers.links.edit")),
			  edit_game_award_path(@game,award), :class => 'btn btn-mini' %>
	      <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
			  game_award_path(@game,award),
			  :method => :delete,
			  :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')),
			  :class => 'btn btn-mini btn-danger' %>
	    
	    <% end %>
	    </td>
	  </tr>
	<% end %>
    <% end %>
  </tbody>
</table>
